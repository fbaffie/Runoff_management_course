<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<meta name="progressive" content="true" />
<meta name="allow-skip" content="true" />

<title>Urban and rural catchments</title>


<!-- highlightjs -->
<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



</head>

<body>



<div class="pageContent band">
<div class="bandContent page">

<div class="topics">

<div id="section-case-study-oslo" class="section level2">
<h2>Case study: Oslo?</h2>
<p><a href="https://www.nve.no/flaum-og-skred/fagsamlinger-2018-2019/" class="uri">https://www.nve.no/flaum-og-skred/fagsamlinger-2018-2019/</a></p>
<p>Use NVE Atlas, Norgeskart, Nevina to find the catchments specific to each water intake in Jostedalen.</p>
<p>Calculate much flow can be achieved in the tunnel</p>
<p>How much flow can be directed from the side-catchments back to the main reservoir by gravity. Will one of the side intake need a non-return valve to avoid a backflow through the intake? Experiment with the behavior of those intakes during various events: intense hourly precipitation, big daily events…</p>
<p>In this tutorial, you will learn how to summarise a table of data, including:</p>
<ul>
<li>How to summarise tables with <code>summarise()</code></li>
<li>How to recognize the most useful families of functions to combine with <code>summarise()</code></li>
<li>How to combine multiple dplyr operations with the pipe, <code>%&gt;%</code></li>
<li>How to compute counts of observations with <code>n()</code></li>
<li>How to summarise groups of observations with <code>group_by()</code> and <code>summarise()</code></li>
</ul>
<p>The readings in this tutorial follow <a href="http://r4ds.had.co.nz/"><em>R for Data Science</em></a>, section 5.6.</p>
<div id="section-setup" class="section level3">
<h3>Setup</h3>
<p>To practice these skills, we will use the <code>flights</code> data set from the nycflights13 package, which you met in <a href="../01-data-basics/01-data-basics.html">Data Basics</a>. This data frame comes from the US <a href="http://www.transtats.bts.gov/DatabaseInfo.asp?DB_ID=120&amp;Link=0">Bureau of Transportation Statistics</a> and contains all 336,776 flights that departed from New York City in 2013. It is documented in <code>?flights</code>.</p>
<p>To visualize the data, we will use the ggplot2 package that you met in <a href="../02-data-vis-basics/02-data-vis-basics.html">Data Visualization Basics</a>.</p>
<p>I’ve preloaded the packages for this tutorial with</p>
<pre class="r"><code>library(tidyverse) # loads dplyr, ggplot2, and others
library(nycflights13)</code></pre>
</div>
</div>
<div id="section-summarise-groups-with-summarise" class="section level2">
<h2>Summarise groups with summarise()</h2>
<div id="section-summarise" class="section level3">
<h3>summarise()</h3>
<p><code>summarise()</code> collapses a data frame to a single row of summaries. You get to choose how many summaries appear in the row and how they are computed:</p>
<pre class="r"><code>summarise(flights, delay = mean(dep_delay, na.rm = TRUE), 
                  total =  sum(dep_delay, na.rm = TRUE))</code></pre>
<pre><code>## Error in summarise(flights, delay = mean(dep_delay, na.rm = TRUE), total = sum(dep_delay, : could not find function &quot;summarise&quot;</code></pre>
<p>(We’ll come back to what that <code>na.rm = TRUE</code> means very shortly.)</p>
<p>Notice that the syntax of <code>summarise()</code> is similar to <code>mutate()</code>. As with <code>mutate()</code>, you give summarise:</p>
<ol style="list-style-type: decimal">
<li>The name of a data frame to transform</li>
<li>One or more column names to appear in the transformed output. Each column name is set equal to the R expression that will generate the content of the column.</li>
</ol>
<p>The main difference between <code>summarise()</code> and <code>mutate()</code> is the type of function that you use to generate the new columns. <code>mutate()</code> takes functions that return an entire vector of output (to append to the original data frame). <code>summarise()</code> takes functions that return a single value (or summary). These values will appear in a new data frame that has only one row.</p>
</div>
<div id="section-group_by" class="section level3">
<h3>group_by()</h3>
<p><code>summarise()</code> is not terribly useful unless you pair it with <code>group_by()</code>. <code>group_by()</code> changes the unit of analysis of the data frame: it assigns observations in the data frame to separate groups, and it instructs dplyr to apply functions separately to each group. <code>group_by()</code> assigns groups by grouping together observations that have the same combinations of values for the variables that you pass to <code>group_by()</code>.</p>
<p>For example, the <code>summarise()</code> code above computes the average delay for the entire data set. If we apply exactly the same code to a data set that has been grouped by date (i.e. the unique combinations of <code>year</code>, <code>month</code>, and <code>day</code>), we get the average delay per date. Click “Run Code” to see what I mean:</p>
<div class="tutorial-exercise" data-label="summarise" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>by_day &lt;- group_by(flights, year, month, day)
summarise(by_day, delay = mean(dep_delay, na.rm = TRUE),
                  total = sum(dep_delay, na.rm = TRUE))</code></pre>
<script type="application/json" data-opts-chunk="1">{"fig.width":6.5,"fig.height":4,"fig.retina":2,"fig.align":"default","fig.keep":"high","fig.show":"asis","out.width":624,"warning":true,"error":true,"message":true,"exercise.df_print":"paged","exercise.timelimit":60,"exercise.checker":"NULL"}</script>
</div>
<div class="tutorial-exercise-support" data-label="summarise-check" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>&quot;Good job!&quot;</code></pre>
</div>
</div>
<div id="section-exercise-1" class="section level3">
<h3>Exercise 1</h3>
<p>Which carrier has the worst delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about <code>flights %&gt;% group_by(carrier, dest) %&gt;% summarise(n())</code>)</p>
<div class="tutorial-exercise" data-label="summariseex4" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<script type="application/json" data-opts-chunk="1">{"fig.width":6.5,"fig.height":4,"fig.retina":2,"fig.align":"default","fig.keep":"high","fig.show":"asis","out.width":624,"warning":true,"error":true,"message":true,"exercise.df_print":"paged","exercise.timelimit":60,"exercise.checker":"NULL"}</script>
</div>
<div class="tutorial-exercise-support" data-label="summariseex4-solution" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>flights %&gt;% 
  group_by(carrier) %&gt;% 
  summarise(avg_delay = mean(dep_delay, na.rm = TRUE)) %&gt;%
  mutate(rank = min_rank(desc(avg_delay))) %&gt;% 
  filter(rank == 1)</code></pre>
</div>
<div id="section-summariseex4-hint">
<p><strong>Hint:</strong> Use<code>min_rank(desc(avg_delay))</code> to rank <code>avg_delay</code> (for example) such that the largest delay receives rank one.</p>
</div>
<div class="tutorial-exercise-support" data-label="summariseex4-check" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>&quot;Great work! Frontier airlines (`F9`) was the highest average departure delay.&quot;</code></pre>
</div>
</div>
<div id="section-exercise-2" class="section level3">
<h3>Exercise 2</h3>
<p>For each plane, count the number of flights before the first delay of greater than 1 hour.</p>
<div class="tutorial-exercise" data-label="summariseex5" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<script type="application/json" data-opts-chunk="1">{"fig.width":6.5,"fig.height":4,"fig.retina":2,"fig.align":"default","fig.keep":"high","fig.show":"asis","out.width":624,"warning":true,"error":true,"message":true,"exercise.df_print":"paged","exercise.timelimit":60,"exercise.checker":"NULL"}</script>
</div>
<div class="tutorial-exercise-support" data-label="summariseex5-solution" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>flights %&gt;% 
  filter(!is.na(dep_delay)) %&gt;% 
  group_by(tailnum) %&gt;% 
  mutate(big_delay = dep_delay &gt; 60,
         before = !cumany(big_delay)) %&gt;% 
  summarise(sum(before))</code></pre>
</div>
<div id="section-summariseex5-hint">
<p><strong>Hint:</strong> One strategy would be to: * filter out all rows where <code>dep_delay</code> is <code>NA</code>. * Then group by plane, * create a variable that tests whether each flight was delayed longer than an hour * create a variable that identifies flights that occur before the first big delay with <code>!cumany()</code> * sum up the number of trues</p>
</div>
<div class="tutorial-exercise-support" data-label="summariseex5-check" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>&quot;Great work! That was tough. Be sure you understand each of the steps and functions involved.&quot;</code></pre>
</div>
</div>
<div id="section-grouping-by-multiple-variables" class="section level3">
<h3>Grouping by multiple variables</h3>
<p>When you group by multiple variables, each summary peels off one level of the grouping. That makes it easy to progressively roll up a dataset. Run the code below and inspect each result to see how its grouping criteria has changed (the grouping criteria is displayed at the top of the tibble).</p>
<div class="tutorial-exercise" data-label="unwrap" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>daily &lt;- group_by(flights, year, month, day)
(per_day &lt;- summarise(daily, total = sum(dep_delay, na.rm = TRUE)))
(per_month &lt;- summarise(per_day, total = sum(total, na.rm = TRUE)))
(per_year  &lt;- summarise(per_month, total = sum(total, na.rm = TRUE)))</code></pre>
<script type="application/json" data-opts-chunk="1">{"fig.width":6.5,"fig.height":4,"fig.retina":2,"fig.align":"default","fig.keep":"high","fig.show":"asis","out.width":624,"warning":true,"error":true,"message":true,"exercise.df_print":"paged","exercise.timelimit":60,"exercise.checker":"NULL"}</script>
</div>
<p>Be careful when you progressively roll up summaries: it’s OK for sums and counts, but you need to think about weighting means and variances, and it’s not possible to do it exactly for rank-based statistics like the median. In other words, the sum of groupwise sums is the overall sum, but the median of groupwise medians is not the overall median.</p>
</div>
<div id="section-ungrouping" class="section level3">
<h3>Ungrouping</h3>
<p>If you need to remove grouping, and return to operations on ungrouped data, use <code>ungroup()</code>.</p>
<pre><code>## Error in group_by(flights, year, month, day): could not find function &quot;group_by&quot;</code></pre>
<pre class="r"><code>daily &lt;- ungroup(daily) # no longer grouped by date</code></pre>
<pre><code>## Error in ungroup(daily): could not find function &quot;ungroup&quot;</code></pre>
<pre class="r"><code>summarise(daily, total = sum(dep_delay, na.rm = TRUE))  # all flights</code></pre>
<pre><code>## Error in summarise(daily, total = sum(dep_delay, na.rm = TRUE)): could not find function &quot;summarise&quot;</code></pre>
</div>
<div id="section-groups-and-dplyr" class="section level3">
<h3>Groups and dplyr</h3>
<p><code>group_by()</code> also works with the other dplyr functions; dplyr will apply <code>filter()</code>, <code>select()</code>, <code>arrange()</code>, and <code>mutate()</code> in a groupwise fashion to grouped data. However, <code>group_by()</code> is the most useful when combined with <code>summarise()</code>. Together <code>group_by()</code> and <code>summarise()</code> provide one of the tools that you’ll use most commonly when working with dplyr: grouped summaries. But before we go any further with this, we need to introduce a powerful new idea: the pipe.</p>
</div>
</div>
<div id="section-combining-multiple-operations" class="section level2">
<h2>Combining multiple operations</h2>
<div id="section-multiple-steps" class="section level3">
<h3>Multiple steps</h3>
<p>Imagine that we want to explore the relationship between the distance and average delay for each destination in <code>flights</code>. Using what you know about dplyr, you might write code like this:</p>
<pre class="r"><code>by_dest &lt;- group_by(flights, dest)</code></pre>
<pre><code>## Error in group_by(flights, dest): could not find function &quot;group_by&quot;</code></pre>
<pre class="r"><code>delay &lt;- summarise(by_dest,
  count = n(),
  dist = mean(distance, na.rm = TRUE),
  delay = mean(arr_delay, na.rm = TRUE)
)</code></pre>
<pre><code>## Error in summarise(by_dest, count = n(), dist = mean(distance, na.rm = TRUE), : could not find function &quot;summarise&quot;</code></pre>
<pre class="r"><code>delay &lt;- filter(delay, count &gt; 20, dest != &quot;HNL&quot;)</code></pre>
<pre><code>## Error in match.arg(method): object &#39;dest&#39; not found</code></pre>
<pre class="r"><code>ggplot(data = delay, mapping = aes(x = dist, y = delay)) +
  geom_point(aes(size = count), alpha = 1/3) +
  geom_smooth(se = FALSE)</code></pre>
<pre><code>## Error in ggplot(data = delay, mapping = aes(x = dist, y = delay)): could not find function &quot;ggplot&quot;</code></pre>
<p>The code works, and we find an interesting effect: It looks like delays increase with distance up to ~750 miles and then decrease. Maybe as flights get longer there’s more ability to make up delays in the air?</p>
<p>Now let’s look at how we prepared the data. There are three steps:</p>
<ol style="list-style-type: decimal">
<li><p>Group flights by destination.</p></li>
<li><p>Summarise to compute distance, average delay, and number of flights.</p></li>
<li><p>Filter to remove noisy points and Honolulu airport, which is almost twice as far away as the next closest airport.</p></li>
</ol>
<p>This code is a little frustrating to write because we have to give each intermediate data frame a name, even though we don’t care about it. Naming things is hard, so this slows down our analysis.</p>
</div>
<div id="section-pipes" class="section level3">
<h3>Pipes</h3>
<p>There’s another way to tackle the same problem. We can turn the code into a pipe with the pipe operator, <code>%&gt;%</code>:</p>
<pre class="r"><code>delays &lt;- flights %&gt;% 
  group_by(dest) %&gt;% 
  summarise(
    count = n(),
    dist = mean(distance, na.rm = TRUE),
    delay = mean(arr_delay, na.rm = TRUE)
  ) %&gt;% 
  filter(count &gt; 20, dest != &quot;HNL&quot;)</code></pre>
<pre><code>## Error in flights %&gt;% group_by(dest) %&gt;% summarise(count = n(), dist = mean(distance, : could not find function &quot;%&gt;%&quot;</code></pre>
<p>Behind the scenes, <code>x %&gt;% f(y)</code> turns into <code>f(x, y)</code>, and <code>x %&gt;% f(y) %&gt;% g(z)</code> turns into <code>g(f(x, y), z)</code> and so on. You can use the pipe to rewrite multiple operations in a way that you can read left-to-right, top-to-bottom.</p>
<p>This focuses on the transformations, not what’s being transformed, which makes the code easier to read. You can read it as a series of imperative statements: group, then summarise, then filter. As suggested by this reading, a good way to pronounce <code>%&gt;%</code> when reading code is “then”.</p>
<p>We’ll use piping frequently from now on because it considerably improves the readability of code, and we’ll come back to it in more detail in <a href="">Pipes</a>.</p>
<p>The pipe is a defining feature of the tidyverse: packages in the tidyverse all contain functions that are designed to work with the pipe. The only exception is ggplot2: it was written before the pipe was discovered. Unfortunately, the next iteration of ggplot2, ggvis, which does use the pipe, isn’t quite ready for prime time yet.</p>
</div>
</div>
<div id="section-summarise-funs" class="section level2">
<h2>Useful summary functions</h2>
<div id="section-aggregating-functions" class="section level3">
<h3>Aggregating functions</h3>
<p>You can get a long way with means and sum; but R provides many other useful functions to use with summary. Each of these functions acts as an <strong>aggregating function</strong>: it takes a vector of values and returns a single value.</p>
<p>Let’s demonstrate some of the most useful aggregating functions with this data set, which removes flights that have no delay information (because they were cancelled).</p>
<pre class="r"><code>not_cancelled &lt;- flights %&gt;% 
  filter(!is.na(dep_delay), !is.na(arr_delay))</code></pre>
<pre><code>## Error in flights %&gt;% filter(!is.na(dep_delay), !is.na(arr_delay)): could not find function &quot;%&gt;%&quot;</code></pre>
<ul>
<li><p><strong>Measures of location</strong>: we’ve used <code>mean(x)</code>, but <code>median(x)</code> is also useful. The mean is the sum divided by the length; the median is a value where 50% of <code>x</code> is above it, and 50% is below it.</p>
<p>It’s sometimes useful to combine aggregation with logical subsetting. We haven’t talked about this sort of subsetting yet, but you’ll learn more about it in <a href="">Subsetting</a>.</p>
<pre class="r"><code>not_cancelled %&gt;% 
  group_by(year, month, day) %&gt;% 
  summarise(
    avg_delay1 = mean(arr_delay),
    avg_delay2 = mean(arr_delay[arr_delay &gt; 0]) # the average positive delay
  )</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(year, month, day) %&gt;% summarise(avg_delay1 = mean(arr_delay), : could not find function &quot;%&gt;%&quot;</code></pre></li>
<li><p><strong>Measures of spread</strong>: <code>sd(x)</code>, <code>IQR(x)</code>, <code>mad(x)</code>. The mean squared deviation, or standard deviation or sd for short, is the standard measure of spread. The interquartile range <code>IQR()</code> and median absolute deviation <code>mad(x)</code>are robust equivalents that may be more useful if you have outliers.</p>
<pre class="r"><code># Why is distance to some destinations more variable than to others?
not_cancelled %&gt;% 
  group_by(dest) %&gt;% 
  summarise(distance_sd = sd(distance)) %&gt;% 
  arrange(desc(distance_sd))</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(dest) %&gt;% summarise(distance_sd = sd(distance)) %&gt;% : could not find function &quot;%&gt;%&quot;</code></pre></li>
<li><p><strong>Measures of rank</strong>: <code>min(x)</code>, <code>quantile(x, 0.25)</code>, <code>max(x)</code>. Quantiles are a generalisation of the median. For example, <code>quantile(x, 0.25)</code> will find a value of <code>x</code> that is greater than 25% of the values, and less than the remaining 75%.</p>
<pre class="r"><code># When do the first and last flights leave each day?
not_cancelled %&gt;% 
  group_by(year, month, day) %&gt;% 
  summarise(
    first = min(dep_time),
    last = max(dep_time)
  )</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(year, month, day) %&gt;% summarise(first = min(dep_time), : could not find function &quot;%&gt;%&quot;</code></pre></li>
<li><p><strong>Measures of position</strong>: <code>first(x)</code>, <code>nth(x, 2)</code>, <code>last(x)</code>. These work similarly to <code>x[1]</code>, <code>x[2]</code>, and <code>x[length(x)]</code> but let you set a default value if that position does not exist (i.e. you’re trying to get the 3rd element from a group that only has two elements). For example, we can find the first and last departure for each day:</p>
<pre class="r"><code>not_cancelled %&gt;% 
  group_by(year, month, day) %&gt;% 
  summarise(
    first_dep = first(dep_time), 
    last_dep = last(dep_time)
  )</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(year, month, day) %&gt;% summarise(first_dep = first(dep_time), : could not find function &quot;%&gt;%&quot;</code></pre>
<p>These functions are complementary to filtering on ranks. Filtering gives you all variables, with each observation in a separate row:</p>
<pre class="r"><code>not_cancelled %&gt;% 
  group_by(year, month, day) %&gt;% 
  mutate(r = min_rank(desc(dep_time))) %&gt;% 
  filter(r %in% range(r))</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(year, month, day) %&gt;% mutate(r = min_rank(desc(dep_time))) %&gt;% : could not find function &quot;%&gt;%&quot;</code></pre></li>
<li><p><strong>Counts</strong>: In the next section, you will meet <code>n()</code>, which takes no arguments, and returns the size of the current group. You can count other useful quantities as well. To count the number of non-missing values, use <code>sum(!is.na(x))</code>. To count the number of distinct (unique) values, use <code>n_distinct(x)</code>.</p>
<pre class="r"><code># Which destinations have the most carriers?
not_cancelled %&gt;% 
  group_by(dest) %&gt;% 
  summarise(carriers = n_distinct(carrier)) %&gt;% 
  arrange(desc(carriers))</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(dest) %&gt;% summarise(carriers = n_distinct(carrier)) %&gt;% : could not find function &quot;%&gt;%&quot;</code></pre></li>
<li><p><strong>Counts and proportions of logical values</strong>: <code>sum(x &gt; 10)</code>, <code>mean(y == 0)</code>. When used with numeric functions, <code>TRUE</code> is converted to 1 and <code>FALSE</code> to 0. This makes <code>sum()</code> and <code>mean()</code> very useful: <code>sum(x)</code> gives the number of <code>TRUE</code>s in <code>x</code>, and <code>mean(x)</code> gives the proportion.</p>
<pre class="r"><code># How many flights left before 5am? (these usually indicate delayed
# flights from the previous day)
not_cancelled %&gt;% 
  group_by(year, month, day) %&gt;% 
  summarise(n_early = sum(dep_time &lt; 500))</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(year, month, day) %&gt;% summarise(n_early = sum(dep_time &lt; : could not find function &quot;%&gt;%&quot;</code></pre>
<pre class="r"><code># What proportion of flights are delayed by more than an hour?
not_cancelled %&gt;% 
  group_by(year, month, day) %&gt;% 
  summarise(hour_perc = mean(arr_delay &gt; 60))</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(year, month, day) %&gt;% summarise(hour_perc = mean(arr_delay &gt; : could not find function &quot;%&gt;%&quot;</code></pre></li>
</ul>
</div>
<div id="section-exercise-3" class="section level3">
<h3>Exercise 3</h3>
<p>Brainstorm at least 5 different ways to assess the typical delay characteristics of a group of flights. Consider the following scenarios:</p>
<ul>
<li><p>A flight is 15 minutes early 50% of the time, and 15 minutes late 50% of the time.</p></li>
<li><p>A flight is always 10 minutes late.</p></li>
<li><p>A flight is 30 minutes early 50% of the time, and 30 minutes late 50% of the time.</p></li>
<li><p>99% of the time a flight is on time. 1% of the time it’s 2 hours late.</p></li>
</ul>
<p>Which is more important: arrival delay or departure delay?</p>
<div class="tutorial-exercise" data-label="summariseex1" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<script type="application/json" data-opts-chunk="1">{"fig.width":6.5,"fig.height":4,"fig.retina":2,"fig.align":"default","fig.keep":"high","fig.show":"asis","out.width":624,"warning":true,"error":true,"message":true,"exercise.df_print":"paged","exercise.timelimit":60,"exercise.checker":"NULL"}</script>
</div>
<div id="section-summariseex1-hint">
<p><strong>Hint:</strong> Consider R’s measures of location and measures of spread.</p>
</div>
</div>
<div id="section-missing-values" class="section level3">
<h3>Missing values</h3>
<p>You may have wondered about the <code>na.rm</code> argument we used in a previous section. What happens if we don’t set it?</p>
<pre class="r"><code>flights %&gt;% 
  group_by(year, month, day) %&gt;% 
  summarise(mean = mean(dep_delay))</code></pre>
<pre><code>## Error in flights %&gt;% group_by(year, month, day) %&gt;% summarise(mean = mean(dep_delay)): could not find function &quot;%&gt;%&quot;</code></pre>
<p>We get a lot of missing values! That’s because aggregation functions obey the usual rule of missing values: if there’s any missing value in the input, the output will be a missing value. Fortunately, all aggregation functions have an <code>na.rm</code> argument which removes the missing values prior to computation:</p>
<pre class="r"><code>flights %&gt;% 
  group_by(year, month, day) %&gt;% 
  summarise(mean = mean(dep_delay, na.rm = TRUE))</code></pre>
<pre><code>## Error in flights %&gt;% group_by(year, month, day) %&gt;% summarise(mean = mean(dep_delay, : could not find function &quot;%&gt;%&quot;</code></pre>
<p>In this case, where missing values represent cancelled flights, we could also tackle the problem by first removing the cancelled flights, as we did to create <code>not_cancelled</code>.</p>
<pre class="r"><code>not_cancelled &lt;- flights %&gt;% 
  filter(!is.na(dep_delay), !is.na(arr_delay))</code></pre>
<pre><code>## Error in flights %&gt;% filter(!is.na(dep_delay), !is.na(arr_delay)): could not find function &quot;%&gt;%&quot;</code></pre>
<pre class="r"><code>not_cancelled %&gt;% 
  group_by(year, month, day) %&gt;% 
  summarise(mean = mean(dep_delay))</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(year, month, day) %&gt;% summarise(mean = mean(dep_delay)): could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="section-exercise-4" class="section level3">
<h3>Exercise 4</h3>
<p>Our definition of cancelled flights (<code>is.na(dep_delay) | is.na(arr_delay)</code>) is slightly suboptimal. Why? Which is the most important column?</p>
</div>
</div>
<div id="section-counts" class="section level2">
<h2>Counts</h2>
<div id="section-n" class="section level3">
<h3>n()</h3>
<p>Whenever you do any aggregation, it’s always a good idea to include either a count (<code>n()</code>), or a count of non-missing values (<code>sum(!is.na(x))</code>). That way you can check that you’re not drawing conclusions based on very small amounts of data. For example, let’s look at the planes (identified by their tail number) that have the highest average delays:</p>
<pre class="r"><code>delays &lt;- not_cancelled %&gt;% 
  group_by(tailnum) %&gt;% 
  summarise(
    delay = mean(arr_delay)
  )</code></pre>
<pre><code>## Error in not_cancelled %&gt;% group_by(tailnum) %&gt;% summarise(delay = mean(arr_delay)): could not find function &quot;%&gt;%&quot;</code></pre>
<pre class="r"><code>ggplot(data = delays, mapping = aes(x = delay)) + 
  geom_freqpoly(binwidth = 10)</code></pre>
<pre><code>## Error in ggplot(data = delays, mapping = aes(x = delay)): could not find function &quot;ggplot&quot;</code></pre>
<p>Wow, there are some planes that have an <em>average</em> delay of 5 hours (300 minutes)!</p>
<p>The story is actually a little more nuanced. We can get more insight if we draw a scatterplot of number of flights vs. average delay. Fill in the blank code below to compute and then plot the number of flights by the mean arrival delay (<code>arr_delay</code>).</p>
<div class="tutorial-exercise" data-label="delays" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code># delays &lt;- not_cancelled %&gt;% 
#   group_by(tailnum) %&gt;% 
#   summarise(
#     delay = _________,
#     n = n()
#   )
# 
# ggplot(data = delays, mapping = aes(x = n, y = delay)) + 
#   geom_point(alpha = 1/10)</code></pre>
<script type="application/json" data-opts-chunk="1">{"fig.width":6.5,"fig.height":4,"fig.retina":2,"fig.align":"default","fig.keep":"high","fig.show":"asis","out.width":624,"warning":true,"error":true,"message":true,"exercise.df_print":"paged","exercise.timelimit":60,"exercise.checker":"NULL"}</script>
</div>
<div class="tutorial-exercise-support" data-label="delays-solution" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>delays &lt;- not_cancelled %&gt;% 
  group_by(tailnum) %&gt;% 
  summarise(
    delay = mean(arr_delay),
    n = n()
  )

ggplot(data = delays, mapping = aes(x = n, y = delay)) + 
  geom_point(alpha = 1/10)</code></pre>
</div>
<p>Not surprisingly, there is much greater variation in the average delay when there are few flights. The shape of this plot is very characteristic: whenever you plot a mean (or other summary) vs. group size, you’ll see that the variation decreases as the sample size increases.</p>
</div>
<div id="section-accounting-for-variation-based-on-sample-size" class="section level3">
<h3>Accounting for variation based on sample size</h3>
<p>When looking at this sort of plot, it’s often useful to filter out the groups with the smallest numbers of observations, so you can see more of the pattern and less of the extreme variation in the smallest groups. This is what the following code does, as well as showing you a handy pattern for integrating ggplot2 into dplyr flows. It’s a bit painful that you have to switch from <code>%&gt;%</code> to <code>+</code>, but once you get the hang of it, it’s quite convenient.</p>
<pre><code>## Error in not_cancelled %&gt;% group_by(tailnum) %&gt;% summarise(delay = mean(arr_delay), : could not find function &quot;%&gt;%&quot;</code></pre>
<pre class="r"><code>delays %&gt;% 
  filter(n &gt; 25) %&gt;% 
  ggplot(mapping = aes(x = n, y = delay)) + 
    geom_point(alpha = 1/10)</code></pre>
<pre><code>## Error in delays %&gt;% filter(n &gt; 25) %&gt;% ggplot(mapping = aes(x = n, y = delay)): could not find function &quot;%&gt;%&quot;</code></pre>
<hr />
<p>RStudio tip: a useful keyboard shortcut is Cmd/Ctrl + Shift + P. This resends the previously sent chunk from the editor to the console. This is very convenient when you’re (e.g.) exploring the value of <code>n</code> in the example above. You send the whole block once with Cmd/Ctrl + Enter, then you modify the value of <code>n</code> and press Cmd/Ctrl + Shift + P to resend the complete block.</p>
<hr />
</div>
<div id="section-sample-size-average-performance-and-rank" class="section level3">
<h3>Sample size, average performance, and rank</h3>
<p>There’s another common variation of this type of pattern. Let’s look at how the average performance of batters in baseball is related to the number of times they’re at bat. Here I use data from the <strong>Lahman</strong> package to compute the batting average (number of hits / number of attempts) of every major league baseball player.</p>
<p>When I plot the skill of the batter (measured by the batting average, <code>ba</code>) against the number of opportunities to hit the ball (measured by at bat, <code>ab</code>), you see two patterns:</p>
<ol style="list-style-type: decimal">
<li><p>As above, the variation in our aggregate decreases as we get more data points.</p></li>
<li><p>There’s a positive correlation between skill (<code>ba</code>) and opportunities to hit the ball (<code>ab</code>). This is because teams control who gets to play, and obviously they’ll pick their best players.</p></li>
</ol>
<pre class="r"><code># Convert to a tibble so it prints nicely
batting &lt;- as_tibble(Lahman::Batting)</code></pre>
<pre><code>## Error in as_tibble(Lahman::Batting): could not find function &quot;as_tibble&quot;</code></pre>
<pre class="r"><code>batters &lt;- batting %&gt;% 
  group_by(playerID) %&gt;% 
  summarise(
    ba = sum(H, na.rm = TRUE) / sum(AB, na.rm = TRUE),
    ab = sum(AB, na.rm = TRUE)
  )</code></pre>
<pre><code>## Error in batting %&gt;% group_by(playerID) %&gt;% summarise(ba = sum(H, na.rm = TRUE)/sum(AB, : could not find function &quot;%&gt;%&quot;</code></pre>
<pre class="r"><code>batters %&gt;% 
  filter(ab &gt; 100) %&gt;% 
  ggplot(mapping = aes(x = ab, y = ba)) +
    geom_point() + 
    geom_smooth(se = FALSE)</code></pre>
<pre><code>## Error in batters %&gt;% filter(ab &gt; 100) %&gt;% ggplot(mapping = aes(x = ab, : could not find function &quot;%&gt;%&quot;</code></pre>
<p>This also has important implications for ranking. If you look closely, the people with the best batting averages are clearly lucky, not skilled.</p>
<p>You can find a good explanation of this problem at <a href="http://varianceexplained.org/r/empirical_bayes_baseball/" class="uri">http://varianceexplained.org/r/empirical_bayes_baseball/</a> and <a href="http://www.evanmiller.org/how-not-to-sort-by-average-rating.html" class="uri">http://www.evanmiller.org/how-not-to-sort-by-average-rating.html</a>.</p>
</div>
<div id="section-count" class="section level3">
<h3>count()</h3>
<p>Counts are so useful that dplyr provides a simple helper if all you want is a count:</p>
<pre class="r"><code>not_cancelled %&gt;% 
  count(dest)</code></pre>
<pre><code>## Error in not_cancelled %&gt;% count(dest): could not find function &quot;%&gt;%&quot;</code></pre>
<pre><code>You can optionally provide a weight variable. For example, you could use this to &quot;count&quot; (sum) the total number of miles a plane flew:</code></pre>
<pre class="r"><code>not_cancelled %&gt;% 
  count(tailnum, wt = distance)</code></pre>
<pre><code>## Error in not_cancelled %&gt;% count(tailnum, wt = distance): could not find function &quot;%&gt;%&quot;</code></pre>
</div>
<div id="section-exercise-5" class="section level3">
<h3>Exercise 5</h3>
<p>Come up with another approach that will give you the same output as <code>not_cancelled %&gt;% count(dest)</code> and <code>not_cancelled %&gt;% count(tailnum, wt = distance)</code> (without using <code>count()</code>).</p>
<div class="tutorial-exercise" data-label="summariseex2" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<script type="application/json" data-opts-chunk="1">{"fig.width":6.5,"fig.height":4,"fig.retina":2,"fig.align":"default","fig.keep":"high","fig.show":"asis","out.width":624,"warning":true,"error":true,"message":true,"exercise.df_print":"paged","exercise.timelimit":60,"exercise.checker":"NULL"}</script>
</div>
<div class="tutorial-exercise-support" data-label="summariseex2-solution" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>not_cancelled %&gt;% 
  group_by(dest) %&gt;% 
  summarise(n = n())

not_cancelled %&gt;% 
  group_by(tailnum) %&gt;% 
  summarise(n = sum(distance))</code></pre>
</div>
<div id="section-summariseex2-hint">
<p><strong>Hint:</strong> Consider the tools at your disposal&quot; <code>group_by()</code>, <code>summarise()</code>, <code>n()</code>, <code>sum()</code>, and <code>?count</code></p>
</div>
<div class="tutorial-exercise-support" data-label="summariseex2-check" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>&quot;Excellent Job! This was a tricky one, but you can now see that `count()` is a handy short cut for `group_by()` + `summarise()` + `n()` (or `sum()`).&quot;</code></pre>
</div>
</div>
<div id="section-exercise-6" class="section level3">
<h3>Exercise 6</h3>
<p>What does the <code>sort</code> argument to <code>count()</code> do. When might you use it?</p>
<div class="tutorial-exercise" data-label="summariseex6" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>?count    </code></pre>
<script type="application/json" data-opts-chunk="1">{"fig.width":6.5,"fig.height":4,"fig.retina":2,"fig.align":"default","fig.keep":"high","fig.show":"asis","out.width":624,"warning":true,"error":true,"message":true,"exercise.df_print":"paged","exercise.timelimit":60,"exercise.checker":"NULL"}</script>
</div>
</div>
<div id="section-exercise-7" class="section level3">
<h3>Exercise 7</h3>
<p>Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?</p>
<div class="tutorial-exercise" data-label="summariseex3" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code># Task 1
# begin with a variable that shows the day of the year
# flights %&gt;% 
#   mutate(date = as.Date(paste(year, month, day, sep = &quot;-&quot;))) %&gt;% 
# create a variable that shows whether a flight is cancelled
# group by day
# create a summary by counting up the number of flights where cancelled is TRUE
# Plot the result against day
    
# Task 2
# recreate the grouped data above
# create a summary by taking the mean of cancelled variable
# ...as well as the average delay
# plot one against the other</code></pre>
<script type="application/json" data-opts-chunk="1">{"fig.width":6.5,"fig.height":4,"fig.retina":2,"fig.align":"default","fig.keep":"high","fig.show":"asis","out.width":624,"warning":true,"error":true,"message":true,"exercise.df_print":"paged","exercise.timelimit":60,"exercise.checker":"NULL"}</script>
</div>
<div class="tutorial-exercise-support" data-label="summariseex3-solution" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>flights %&gt;% 
  mutate(date = as.Date(paste(year, month, day, sep = &quot;-&quot;))) %&gt;%  
  mutate(cancelled = is.na(dep_delay) | is.na(arr_delay)) %&gt;% 
  group_by(date) %&gt;% 
  summarise(n = sum(cancelled)) %&gt;% 
  ggplot(aes(x = date, y = n)) +
    geom_point() +
    geom_smooth()
    
flights %&gt;% 
  mutate(date = as.Date(paste(year, month, day, sep = &quot;-&quot;))) %&gt;%  
  mutate(cancelled = is.na(dep_delay) | is.na(arr_delay)) %&gt;% 
  group_by(date) %&gt;% 
  summarise(prop = mean(cancelled), avg_delay = mean(dep_delay, na.rm = TRUE)) %&gt;% 
  ggplot(aes(x = prop, y = avg_delay)) +
    geom_point()</code></pre>
</div>
<div id="section-summariseex3-hint">
<p><strong>Hint:</strong> Don’t forget to use <code>na.rm = TRUE</code> where appropriate.</p>
</div>
<div class="tutorial-exercise-support" data-label="summariseex3-check" data-caption="Code" data-completion="1" data-diagnostics="1" data-startover="1" data-lines="0">
<pre class="text"><code>&quot;Wow! You did awesome.&quot;</code></pre>
</div>

<script type="application/shiny-prerendered" data-context="server-start">
library(learnr)
tutorial_options(exercise.timelimit = 60)
knitr::opts_chunk$set(error = TRUE)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
learnr:::register_http_handlers(session, metadata = NULL)
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-summarise-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-summarise-code-editor`)), session)
output$`tutorial-exercise-summarise-output` <- renderUI({
  `tutorial-exercise-summarise-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-summariseex4-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-summariseex4-code-editor`)), session)
output$`tutorial-exercise-summariseex4-output` <- renderUI({
  `tutorial-exercise-summariseex4-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-summariseex5-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-summariseex5-code-editor`)), session)
output$`tutorial-exercise-summariseex5-output` <- renderUI({
  `tutorial-exercise-summariseex5-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-unwrap-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-unwrap-code-editor`)), session)
output$`tutorial-exercise-unwrap-output` <- renderUI({
  `tutorial-exercise-unwrap-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-summariseex1-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-summariseex1-code-editor`)), session)
output$`tutorial-exercise-summariseex1-output` <- renderUI({
  `tutorial-exercise-summariseex1-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-delays-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-delays-code-editor`)), session)
output$`tutorial-exercise-delays-output` <- renderUI({
  `tutorial-exercise-delays-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-summariseex2-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-summariseex2-code-editor`)), session)
output$`tutorial-exercise-summariseex2-output` <- renderUI({
  `tutorial-exercise-summariseex2-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-summariseex6-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-summariseex6-code-editor`)), session)
output$`tutorial-exercise-summariseex6-output` <- renderUI({
  `tutorial-exercise-summariseex6-result`()
})
</script>
 
<script type="application/shiny-prerendered" data-context="server">
`tutorial-exercise-summariseex3-result` <- learnr:::setup_exercise_handler(reactive(req(input$`tutorial-exercise-summariseex3-code-editor`)), session)
output$`tutorial-exercise-summariseex3-output` <- renderUI({
  `tutorial-exercise-summariseex3-result`()
})
</script>
 <!--html_preserve-->
<script type="application/shiny-prerendered" data-context="dependencies">
{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery-1.11.3"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootstrap"]},{"type":"character","attributes":{},"value":["3.3.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/bootstrap-3.3.5"]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["viewport"]}},"value":[{"type":"character","attributes":{},"value":["width=device-width, initial-scale=1"]}]},{"type":"character","attributes":{},"value":["js/bootstrap.min.js","shim/html5shiv.min.js","shim/respond.min.js"]},{"type":"character","attributes":{},"value":["css/cerulean.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["pagedtable"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/pagedtable-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["js/pagedtable.js"]},{"type":"character","attributes":{},"value":["css/pagedtable.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["highlightjs"]},{"type":"character","attributes":{},"value":["1.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["href"]}},"value":[{"type":"character","attributes":{},"value":["EX04-urban_hydro_files/highlightjs-1.1"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["highlight.js"]},{"type":"character","attributes":{},"value":["textmate.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.9.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-autocompletion"]},{"type":"character","attributes":{},"value":["0.9.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-autocompletion.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-diagnostics"]},{"type":"character","attributes":{},"value":["0.9.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-diagnostics.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-format"]},{"type":"character","attributes":{},"value":["0.9.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmarkdown/templates/tutorial/resources"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-format.js"]},{"type":"character","attributes":{},"value":["tutorial-format.css","rstudio-theme.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["jquery"]},{"type":"character","attributes":{},"value":["1.11.3"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/jquery-1.11.3"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["jquery.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["font-awesome"]},{"type":"character","attributes":{},"value":["4.5.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["rmd/h/font-awesome-4.5.0"]}]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["css/font-awesome.min.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["rmarkdown"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["bootbox"]},{"type":"character","attributes":{},"value":["4.4.0"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/bootbox"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["bootbox.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["localforage"]},{"type":"character","attributes":{},"value":["1.5"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/localforage"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["localforage.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial"]},{"type":"character","attributes":{},"value":["0.9.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial.js"]},{"type":"character","attributes":{},"value":["tutorial.css"]},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-autocompletion"]},{"type":"character","attributes":{},"value":["0.9.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-autocompletion.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["tutorial-diagnostics"]},{"type":"character","attributes":{},"value":["0.9.1"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/tutorial"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["tutorial-diagnostics.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.2.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["1.5.15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.2.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["1.5.15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.2.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["1.5.15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.2.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["1.5.15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.2.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["1.5.15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.2.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["1.5.15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.2.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["1.5.15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.2.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["1.5.15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["ace"]},{"type":"character","attributes":{},"value":["1.2.6"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/ace"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["ace.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","version","src","meta","script","stylesheet","head","attachment","package","all_files"]},"class":{"type":"character","attributes":{},"value":["html_dependency"]}},"value":[{"type":"character","attributes":{},"value":["clipboardjs"]},{"type":"character","attributes":{},"value":["1.5.15"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["file"]}},"value":[{"type":"character","attributes":{},"value":["lib/clipboardjs"]}]},{"type":"NULL"},{"type":"character","attributes":{},"value":["clipboard.min.js"]},{"type":"NULL"},{"type":"NULL"},{"type":"NULL"},{"type":"character","attributes":{},"value":["learnr"]},{"type":"logical","attributes":{},"value":[true]}]}]}
</script>
<!--/html_preserve-->
</div>
</div>

</div> <!-- topics -->

<div class="topicsContainer">
<div class="topicsPositioner">
<div class="band">
<div class="bandContent topicsListContainer">

<!-- begin doc-metadata -->
<div id="doc-metadata">
<h2 class="title toc-ignore" style="display:none;">Urban and rural catchments</h2>
</div>
<!-- end doc-metadata -->

</div> <!-- bandContent.topicsListContainer -->
</div> <!-- band -->
</div> <!-- topicsPositioner -->
</div> <!-- topicsContainer -->


</div> <!-- bandContent page -->
</div> <!-- pageContent band -->




<script>
// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>

</html>
